<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>PackageDevelopment</title>
    <meta charset="utf-8" />
    <meta name="author" content="Miriam Lerma" />
    <script src="PackageDevelop_files/header-attrs-2.6/header-attrs.js"></script>
    <script src="PackageDevelop_files/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="PackageDevelop_files/xaringanExtra-clipboard-0.2.4/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="PackageDevelop_files/xaringanExtra-clipboard-0.2.4/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="PackageDevelop_files/panelset-0.2.4/panelset.css" rel="stylesheet" />
    <script src="PackageDevelop_files/panelset-0.2.4/panelset.js"></script>
    <link rel="stylesheet" href="Package-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">





class: title-slide, center, middle
background-image: url(https://images.unsplash.com/photo-1518289646039-3e6c87a5aaf6?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1351&amp;q=80)
background-size: cover

&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #000000 !important;" &gt;Crear tus propios&lt;/span&gt; &lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #000000 !important;font-size: 120px;" &gt;Paquetes&lt;/span&gt;

&lt;br&gt;
&lt;h2&gt;&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #000000 !important;" &gt;Miriam Lerma&lt;/span&gt;&lt;/h2&gt;

&lt;h3&gt;&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #000000 !important;" &gt;Mayo 2021&lt;/span&gt;&lt;/h3&gt;


---
class: inverse

# Indice

- [Que es un paquete](#intro)  
- [Licencia](#licencia)  
- [Como agregar datos](#datos)
- [Agregar datos al paquete](#datos_ex) 
- [Como crear función](#funciones)
- [Crear función](#funciones_ex)
- [Como crear hexsticker](#sticker)





---

class: inverse

# Créditos y recursos

- Paquetes  
[&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 640 512"&gt;&lt;path d="M0 256v128c0 17.7 14.3 32 32 32h32V224H32c-17.7 0-32 14.3-32 32zM464 96H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H176c-44.2 0-80 35.8-80 80v272c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V176c0-44.2-35.8-80-80-80zM256 416h-64v-32h64v32zm-32-120c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40zm128 120h-64v-32h64v32zm96 0h-64v-32h64v32zm-32-120c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40zm192-72h-32v192h32c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32z"/&gt;&lt;/svg&gt; usethis](https://usethis.r-lib.org/)  
[&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 640 512"&gt;&lt;path d="M0 256v128c0 17.7 14.3 32 32 32h32V224H32c-17.7 0-32 14.3-32 32zM464 96H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H176c-44.2 0-80 35.8-80 80v272c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V176c0-44.2-35.8-80-80-80zM256 416h-64v-32h64v32zm-32-120c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40zm128 120h-64v-32h64v32zm96 0h-64v-32h64v32zm-32-120c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40zm192-72h-32v192h32c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32z"/&gt;&lt;/svg&gt; testthat](https://testthat.r-lib.org/)

- Libros&lt;br&gt;
[&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 576 512"&gt;&lt;path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"/&gt;&lt;/svg&gt; R Packages](https://r-pkgs.org/intro.html)

- Tutoriales sobre datos &lt;br&gt;
[&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt; Incluir datos](https://r-pkgs.org/man.html) &lt;br&gt;
[&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt; Documentar datos](https://kbroman.org/pkg_primer/pages/data.html) &lt;br&gt;

- Blogs sobre funciones &lt;br&gt;
Tu paquete en una hora por &lt;br&gt;
[&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt; Piping hot data](https://www.pipinghotdata.com/posts/2020-10-25-your-first-r-package-in-1-hour/)&lt;br&gt;

- Videos&lt;br&gt;
[&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 576 512"&gt;&lt;path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/&gt;&lt;/svg&gt; Rladies como crear funciones](https://www.youtube.com/watch?v=TCIMT6l53tQ&amp;t)&lt;br&gt;
[&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 576 512"&gt;&lt;path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/&gt;&lt;/svg&gt; Rladies como crear paquetes](https://www.youtube.com/watch?v=IlWMkz769B4&amp;t)

---
name: intro
class: title-slide, center, middle
background-image: url(https://images.unsplash.com/photo-1518289646039-3e6c87a5aaf6?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1351&amp;q=80)
background-size: cover

&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #000000 !important;font-size: 120px;" &gt;Paquetes&lt;/span&gt;

---

# 1. Intro

**Problemas**
- Repito pasos y análisis con datos similares...  
.right[ _hasta ahora reciclo funciones de scripts anteriores_ ]

- Estudiantes y colegas me preguntan como realizar análisis similares...  
.right[ _muchos no estan familizarizados con la sintaxis de las funciones_]

- Los artículos me piden más detalles de como se realizaron los análisis...   
.right[ _el espacio es limitado para dar detalles_ ]

- Aunque existan paquetes similares no cubren todos los pasos...   
.right[  _sirven de inspiracion pero no resuelven mi problema_ ]

**Motivantes**

- Quiero que otras personas puedan replicar mis análisis y que las funciones estén accesibles.

- Quiero hacer las funciones y documentación este en ingles y español.  

---

## 1.2. Crear paquete

**Paquete**  
Para crear paquetes se puede usar el paquete **usethis**

Para instalar y cargar el paquete:

```r
#install.packages('usethis')
library(usethis)
```

---

## 1.2. Checa nombre

Antes de iniciar a crear un paquete, se puede consultar el nombre en la página [CRAN](https://cran.r-project.org/)

También existe el paquete **available** para revisar si el paquete ya existe en CRAN o en github y si el nombre de tu paquete puede ser ofensivo.

```r
install.packages('available')
library(available)
available("nombre_paquete")
```

Ejemplo con este paquete:

```r
available("spheniscus")
```

Pregunta si quieres que revise por contenido ofensivo, puedes poner **Y**.

```r
Urban Dictionary can contain potentially offensive results,
  should they be included? [Y]es / [N]o:
```
Después te abre las paginas para mostrarte que significa el nombre de tu paquete.

---

## 1.3. Crear

Para crear un paquete la función **create_package** crea el **esqueleto** de los paquetes.  &lt;br&gt;
Dentro pon el nombre del paquete que te interesa.  

```r
usethis::create_package("nombre_paquete")
```

Aparecera algo así:

```r
√ Creating 'nombre_paquete/'
√ Setting active project to '...'
√ Creating 'R/'
√ Writing 'DESCRIPTION'
Package: nombre_paquete
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R (parsed):
    * First Last &lt;first.last@example.com&gt; [aut, cre] (YOUR-ORCID-ID)
Description: What the package does (one paragraph).
License: `use_mit_license()`, `use_gpl3_license()` or friends to
    pick a license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1
√ Writing 'NAMESPACE'
√ Writing 'nombre_paquete.Rproj'
√ Adding '^nombre_paquete\\.Rproj$' to '.Rbuildignore'
√ Adding '.Rproj.user' to '.gitignore'
√ Adding '^\\.Rproj\\.user$' to '.Rbuildignore'
√ Opening '...' in new RStudio session
√ Setting active project to '&lt;no active project&gt;'
```

---

## 1.3. Archivos

&lt;h1&gt;  📄📂️ &lt;/h1&gt;

La función anterior creo los archivos:
- .gitignore
- .Rbuildignore
- DESCRIPTION
- NAMESPACE
- README.md


Los Folders:
- R


---

## 1.1. Intro

Si te encuentras dentro de un **proyecto** va a preguntar si deseas sobregrabar el proyecto existente.  

Si es el caso: **2: Absolutely**


```r
v Writing 'NAMESPACE'
Overwrite pre-existing file 'nombre_paquete.Rproj'?

1: Not now
2: Absolutely
3: No way
```

Aparecer algo como:

```r
v Writing 'nombre_paquete.Rproj'
v Adding '^nombre_paquete\\.Rproj$' to '.Rbuildignore'
v Adding '^\\.Rproj\\.user$' to '.Rbuildignore'
v Opening '...' in new RStudio session
v Setting active project to '&lt;no active project&gt;'
```

Se abrirá el proyecto en otra ventana.


---

## 1.2. Git

Si ya tienes instalado git puedes directamente conectar el paquete con tu repositorio, escribiendo en tu consola:

```r
usethis::use_git()
```

Aparecerá algo como:

```r
√ Setting active project to '...'
√ Adding '.Rdata', '.httr-oauth', '.DS_Store' to '.gitignore'
There are 6 uncommitted files:
 '.gitignore'
 '.Rbuildignore'
 'DESCRIPTION'
 'NAMESPACE'
Is it ok to commit them?

1: Absolutely not
2: Yup
3: Negative
```

3: Yup... es **si**

---

## 1.2. Git

Aparecerá algo como:

```r
√ Adding files
√ Making a commit with message 'Initial commit
 A restart of RStudio is required to activate the Git pane
Restart now?
1: Yup
2: No
3: Not now
```
Si deseas reiniciar RStudio para activar git:  
1: Yup... es **sip**

Se reiniciara la sesión

---

## 1.3. Github

Otra vez en la consola escribir:

```r
usethis::use_github()
```

Aparecer algo como:

```r
i Defaulting to https Git protocol
√ Setting active project to 'C:/...'
√ Checking that current branch is default branch ('master')
√ Creating GitHub repository '...'
√ Setting remote 'origin' to 'https://github.com/...git'
√ Setting URL field in DESCRIPTION to 'https://github.com/...'
√ Setting BugReports field in DESCRIPTION to 'https://github.com/...'
There is 1 uncommitted file:
 'DESCRIPTION'
Is it ok to commit it?
1: No
2: No way
3: I agree
```
Si es correcto elegir 3: I agree, que significa de acuerdo

---

## 1.4. Github

Aparecerá algo como:

```r
√ Adding files
√ Making a commit with message 'Add GitHub links to DESCRIPTION'
√ Pushing 'master' branch to GitHub and setting 'origin/master' as upstream branch
√ Opening URL 'https://github.com/...'
```
Abrirá github

---

## 1.4. devtools

Escribir en la consola

```r
devtools::check()
```

Al hacer esto, se reviso la versión, plataforma, sesiones y demás.   
Tarda un poquito.  ⏳


```r
0 errors √ | 1 warning x | 0 notes √
```

El **warning** ocurre porque hay que darle una licencia al paquete.

```r
Non-standard license specification:
    `use_mit_license()`, `use_gpl3_license()` or friends to pick a
    license
  Standardizable: FALSE
```


---

name: licencia

## 1.5. Licencia

Para sofware la licencia más común es **MIT**

```r
usethis::use_mit_license("Mi Nombre")
```

Aparecer algo como:

```r
√ Setting License field in DESCRIPTION to 'MIT + file LICENSE'
√ Writing 'LICENSE'
√ Writing 'LICENSE.md'
√ Adding '^LICENSE\\.md$' to '.Rbuildignore'
```

Para revisar si funcionó

```r
devtools::check()
```

Tarda un poquito

```r
0 errors √ | 0 warning √ | 0 notes √
```

---

## 1.6. metadata

Para agregar metadata se debe abrir y modificar el documento que dice DESCRIPTION, agregando tus datos.  

Esta es la información de contacto si hay problemas con el paquete.  

```r
Authors@R:
  person(given = "Miriam",
         family = "Lerma",
         role = c("aut", "cre"),
         email = "miriamjlerma@gmail.com",
         comment = c(ORCID = "0000-0002-7632-9289"))
```

---

## 1.7. README

Para crear un nuevo README, el paquete **usethis** tiene una función para crearlo de manera automática,


```r
library(usethis)
use_readme_rmd(open = rlang::is_interactive())
```


```r
√ Setting active project to '...'
√ Writing 'README.Rmd'
√ Adding '^README\\.Rmd$' to '.Rbuildignore'
 Modify 'README.Rmd'
√ Writing '.git/hooks/pre-commit'
```


---

name: datos
class: title-slide, center, middle
background-image: url(https://images.unsplash.com/photo-1518289646039-3e6c87a5aaf6?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1351&amp;q=80)
background-size: cover

&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #000000 !important;font-size: 120px;" &gt;Datos&lt;/span&gt;


---

# 2. Datos



Por convención los datos puedes ser colocados en una carpeta que se llame **data** en el paquete. &lt;br&gt;
Puedes hacer eso abriendo la pestaña de **Files** y eligiendo **New Folder**. &lt;br&gt;

Para comprimir datos pesados puedes guardarlos como .rda.

```r
save(TDR_raw, file="TDR_raw.rda")
```

Para revisar el peso de los datos puedes usar

```r
object.size(TDR_raw)
```


```r
pryr::mem_used()
```

---

## 2.1. Documentar datos

Para documentar tus datos, puedes abrir un nuevo script (File&gt;NewFile&gt;R Script) o usar la función del paquete **usethis**.

```r
usethis::use_r("mis_datos")
```

Esta función agrega comentarios Roxigen y guarda el documento en tu folder llamado **R**. &lt;br&gt;
En mi caso yo le di al script el mismo nombre que a los datos. 

```r
#' Mis datos son datos de...
#' Contiene 264197 obs de 1 variable.
#' @docType data
#' @usage data(mis_datos)
#' @format Un data frame con 1 variable
#' @keywords datasets
#' @references Lerma et al. 2021
#' @examples
#' data(mis_datos)
"mis_datos"
```

---

## 2.1. Documentar datos

Una vez creado el archivo **.rda** y **.R** se puede revisar si funcionó usando funciones del paquete **devtools**

```r
devtools::check()
```

Si los datos son muy pesados y te aparece un mensaje como este:

```r
Note: significantly better compression could be obtained
          by using R CMD build --resave-data
```

Es mejor agregar el argumento compress.

```r
save(TDR_raw, file="TDR_raw.rda", compress = "xz")
```

---

## 2.2. Instalar el paquete

Si despues de usar **devtools::check()**, aparece:

```r
0 errors √ | 0 warnings √ | 0 notes √
```
Ya tienes tu primer paquete con datos 🥳.

- Para instalar el paquete de manera local

```r
devtools::install("C:/....")
```

- Para instalar el paquete desde github

```r
devtools::install_github("Desarrollador/paquete")
```

---

## 2.3. Ejemplo

Puedes probar como acceder a datos de un paquete usando el paquete spheniscus como ejemplo.

Instalar paquete **spheniscus**

```r
devtools::install_github("MiriamLL/spheniscus")
```

Cargar paquete

```r
library(spheniscus)
```

Cargar datos como objeto

```r
TDR_raw&lt;-TDR_raw
```

---
name: datos_ex
class: inverse

## 2.4. Ejercicios

Agrega datos al paquete

.panelset[
.panel[.panel-name[Crear]

```r
save(mis_datos, file="mis_datos.rda")
```
**Nota** tu objeto, tu documento rda y tu R deben tener el mismo nombre. 
]

.panel[.panel-name[Documentar]


```r
usethis::use_r("mis_datos")
```

Insertar Roxigen Skeleton  (CTRL+ALT+SHIFT+R) o copiar y pegar de otro archivo


```r
devtools::document()
```
]

.panel[.panel-name[Checar]

```r
devtools::check()
```
]
]

---
name: funciones
class: title-slide, center, middle
background-image: url(https://images.unsplash.com/photo-1518289646039-3e6c87a5aaf6?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1351&amp;q=80)
background-size: cover

&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #000000 !important;font-size: 120px;" &gt;Funciones&lt;/span&gt;

---

# 3. Funciónes

Para este paso deberías tener alguna función en mente.  

Si aún no sabes como crear tu primera función puedes ir a [r4ds](https://r4ds-en-espaniol.netlify.app/funciones.html).  

La estructura es algo así:

```r
nombre_de_la_funcion&lt;-function(argumentos){
  algo_que_haga_la_funcion_usando(argumentos)
  return(resultado)
}
```

---

## 3.1. Funciones con dependencia

Te recomiendo probar tu función con datos de ejemplo, antes de incluirla en el paquete.  

- Revisa que paquetes son requeridos, por ejemplo: **tidyr** 


- Define los argumentos por separado como objeto.

```r
data=misdatos
mi_primer_argumento='mi_primer_argumento'
mi_segundo_argumento='mi_segundo_argumento'
```

- Prueba la función

```r
mi_funcion(data = mis_datos,
           mi_primer_argumento='mi_primer_argumento',
           mi_segundo_argumento='mi_segundo_argumento')
```


Otra opción es usar el paquete ['testthat'](https://testthat.r-lib.org/) para probar tu función.

---

### 3.1.2. Agregar función

Para agregar la función al paquete:

```r
usethis::use_r("tu_funcion")
```

**Abre un nuevo Rscript**  
Pegua allí la función

Te aparecera algo como:

```r
 Modify 'R/tu_funcion.R'
 Call `use_test()` to create a matching test file
```
Ahora en la carpeta **R** dentro del paquete aparece la función.  
  
  
**Nota** sugiere que uses use_test pero puede en conflicto con el siguiente paso.
Puedes usar rm() para quitar tu función.

---

### 3.1.3. Probar funcion

Para poner la función en la memoria local y confirmar que se ejecute hay que incluirla en el paquete y probarla.

```r
devtools::load_all()
```

---

### 3.1.4. Documentar la función

Para documentar la función hay que crear un Roxigen skeleton.  
Para esto se debe poner el cursor justo en la primera linea de la función.  
Después ir a la pestaña de Code&gt;Insert Reoxygen Skeleton (tambíen funciona con Control+Alt+Shift+R).  

Va a aparecer algo así:

```r
#' Title
#'
#' @param data 
#' @param mi_primer_argumento 
#' @param mi_segundo_argumento 
#'
#' @return
#' @export
#'
#' @examples
```
**Nota** que identifica de manera automática las variables de la función

---


### 3.1.5. Agregar la función 

Ahora, que ya esta la función y la documentación para agregar el paquete hay que escribir en la consola:

```r
devtools::document()
```

Aparece:

```r
Writing NAMESPACE
Writing mi_funcion.Rd
```

Ahora en la carpeta **man**, aparece un documento rellenado.  
**man** viene de manual y esta es la documentación del paquete.  

**Nota** No debe ser editado de manera manual.  

Puedes revisar la documentación de la función.

```r
?mi_funcion
```

---

### 3.1.6. Dependencias

Dependencias son paquetes necesarios para que la función, funcione.

Para revisar si necesitas dependencias se puede usar: 

```r
devtools::check()
```
Si tu paquete tiene dependencias, apareceran errores, warnings y notas.  

Por ejemplo un paquete tiene que tiene: 
- un **%&gt;% (pipe)** depende del paquete **magrittr**, y 
- la función **separate** depende del paquete **dplyr**.

---

### 3.1.7 Agregar dependencias

Para agregar las dependencias se puede escribir el nombre de los paquetes dentro de la función **use_package**

```r
usethis::use_package("dplyr")
```

Aparecera algo como:

```r
√ Adding 'dplyr' to Imports field in DESCRIPTION
 Refer to functions with `dplyr::fun()`
```

Asi mismo aparecera en DESCRIPTION:

```r
Imports: 
    dplyr
```

Lo siguiente es especificar el paquete en la función, tal como recomienda el siguiente mensaje.  

```r
 Refer to functions with `dplyr::fun()`
```

---

### 3.1.7 Agregar pipe

La función **pipe (%&gt;%)** del paquete magrittr es especial.  

Por lo que hay que usar:

```r
usethis::use_pipe()
```

Aparecera algo como: 

```r
√ Adding 'magrittr' to Imports field in DESCRIPTION
√ Writing 'R/utils-pipe.R'
 Run `devtools::document()` to update 'NAMESPACE'
```

Se recomienda volver a documentar.

```r
devtools::document()
```

Ahora debera aparecer en R un script llamado **utils-pipe.R** y  
en la DESCRIPTION debera aparecer **Imports magrittr**

---

### 3.1.8. Checar paquete

```r
devtools::check()
```


```r
0 errors √ | 0 warnings √ | 0 notes √
```

Listo el paquete esta listo para ser usado por otros.
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

.center[
&lt;h1&gt;🥳&lt;/h1&gt;
]

---
name: segunda

## 3.2. Función sin dependencias

Una vez creada una funcion con dependencias declaradas. Una nueva funcion que use los mismos paquetes puede ser creada reduciendo pasos.  


```r
mi_segunda_funcion(data = mis_datos,
           mi_primer_argumento='mi_primer_argumento',
           mi_segundo_argumento='mi_segundo_argumento')
```

Para agregar la función al paquete

```r
usethis::use_r("mi_segunda_funcion")
```

**Abre un nuevo script**  
Pega allí la función

Aparecera algo como: 

```r
√ Setting active project to 'C:/...'
 Modify 'R/mi_segunda_funcion.R'
 Call `use_test()` to create a matching test file
```
Ahora en la carpeta R aparecera dentro la función

---

### 3.2.1. Documentar la funcion
Agregar un Roxigen skeleton:  
- Poner el cursor justo en la primera linea de la función. 
- Abrir la pestaña de Code&gt;Insert Reoxygen Skeleton (también funciona con Control+Alt+Shift+R).  

Aparecera algo como:

```r
#' Title
#'
#' @param data 
#' @param trip_start 
#' @param trip_end 
#'
#' @return
#' @export
#'
#' @examples
```


---

### 3.2.2. Agregar la función

Para agregar la función al paquete:  
Escribir en la consola

```r
devtools::document()
```

Aparecera algo como:

```r
Writing NAMESPACE
Writing mi_segunda_funcion.Rd
```

Al abrir la carpeta **man** aparecera un documento rellenado.  
El nombre **man** viene de manual y esta es la documentación del paquete.  
No debe ser editado de manera manual.

Ya puedes revisar la documentación.

```r
?mi_segunda_funcion
```

Esta función no tiene nuevas dependencias, así que se puede omitir ese paso.  


```r
devtools::check()
```

---

## 3.3. Funcion con stats

Cuando queremos agregar alguna función que incluya cálculos de desviación estándar, aunque no se necesite cargar el paquete en RStudio, la función proviene de un paquete.

El paquete es **stats** 

Por lo tanto el paquete **stats** debe ser incluido en las dependencias.

```r
usethis::use_package("stats")
```

Y agregado a la función.

```r
resultado&lt;- data %&gt;%
    dplyr::summarise(max_depth_mean=mean(.data[[var1]]),
                     max_depth_sd=stats::sd(.data[[var1]]),
                     max_depth_max=max(.data[[var1]]))
```


```r
devtools::document()
devtools::check()
```

---

## 3.4.  Funcion con ggplot

Cuando creamos una función con ggplot hay que declarar el uso de la función en varios argumentos de la función.  [Leer mas](https://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html).

Si no, aparecera un error:

```r
1 error x | 0 warnings √ | 1 note x
```

Esto occurre debido a que al revisar el paquete, no detecta varias funciones del paquete ggplot.  

```r
no visible global function definition for 'aes'
```

Ejemplo.    

```r
ggplot2::ggplot(data=data,ggplot2::aes(x=.data[[var1]],
                              y=as.numeric(.data[[var2]])))+
    ggplot2::geom_line()+
    ggplot2::ylab("Diving depth (m)")+
    ggplot2::xlab("Month.Day Hour:Minute")+
    ggplot2::scale_y_reverse()+
    ggplot2::theme_bw()
```

---

### 3.3.1. Funcion con ggplot


```r
checking R code for possible problems ...
```

Tambien pueden aparecer problemas con las variables al usar ggplot dentro de una funcion.

```r
no visible binding for global variable '.mis_datos'
```

Para resolver esto hay que declarar las variables dentro de la funcion y posteriormente usar .data

```r
data&lt;-TDR_trip
var1&lt;-time_column
var2&lt;-depth_column
  
ggplot2::ggplot(data,
                ggplot2::aes(x=.data[[var1]],
                             y=.data[[var2]))+
    ggplot2::geom_line()
```


```r
devtools::document()
devtools::check()
```

---

## 3.5. Algunos problemas

### 3.5.1. Usar assign

**Problema**
En algunas funciones puedes haber usado:

```r
assign("mi_resultado", mi_resultado, envir = .GlobalEnv)
```

Usar assign no es recomendado, por lo que aparecera una nota.  

```r
0 errors √ | 0 warnings √ | 1 note x
```

**Solucion**
Usar return().

```r
return(mi_resultado)
```

Si vuelves a checar, debera desaparecer esa nota.

```r
devtools::check()
```

---

### 3.5.2. Ejemplo muy largo

**Problema**
El ejemplo tiene mas de 100 characteres, es considerado muy largo.  

```r
\examples lines wider than 100 characters:
```

**Solución**   
Separar en la documentación

```r
#' t_format&lt;-"%d-%m-%Y %H:%M:%S"
#' t_start&lt;-"30-11-2018 20:43:24"
#' t_end&lt;-"01-12-2018 20:16:19"
#' TDR_trip&lt;-cut_trip(data=TDR_pressure,timeformat=t_format,trip_start=t_start,trip_end=t_end)
```

**Resuelto**

```r
0 errors √ | 0 warnings √ | 0 notes √
```

---

### 3.5.3. Multiples resultados

**Problema**
R solo permite un solo return dentro de las funciones. 

**Solución**   
Crea una lista con los returns

```r
funcion(primer_argumento, segundo_argumento){
  multiplicacion&lt;-primer_argumento*segundo_argumento
  suma&lt;-primer_argumento+segundo_argumento
  lista&lt;-(list("multiplicacion"=multiplicacion,"suma"=suma))
  return(lista)
}
```

---

name: funciones_ex
class: inverse
## 3.6. Ejercicios

Crea tu propia funcion

.panelset[
.panel[.panel-name[Crear]

```r
usethis::use_r("nombre_funcion")
```

Insertar Roxigen Skeleton  (CTRL+ALT+SHIFT+R)
]

.panel[.panel-name[Documentar]

```r
devtools::document()
```
]

.panel[.panel-name[Checar]

```r
devtools::check()
```
]

.panel[.panel-name[Dependencias]

```r
usethis::use_package("ggplot2")
```

Referirse a funciones con ::
]
]


---

class: title-slide, center, middle
background-image: url(https://images.unsplash.com/photo-1518289646039-3e6c87a5aaf6?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1351&amp;q=80)
background-size: cover

&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #000000 !important;font-size: 120px;" &gt;Otros&lt;/span&gt;


---

name: sticker

# 4.1. Crear tu propio sticker

Para crear un hexSticker puedes usar plantillas:
- En powerpoint [plantilla hecha por Emi Tanaka](https://emitanaka.org/posts/hexsticker/) &lt;br&gt;
- En R [paquete hexSticker hecho por GuangchuangYu](https://github.com/GuangchuangYu/hexSticker)

Para instalar el paquete hexSticker (esta en CRAN):  

```r
install.packages("hexSticker")
```

---

# 4.2. Zenodo

&lt;img src="https://upload.wikimedia.org/wikipedia/commons/0/0f/Zenodo_logo.jpg" height="50" style="display: block; margin: auto;" /&gt;

[Zenodo](https://zenodo.org/) es un repositorio de acceso abierto operado por CERN (Organización Europea para la Investigación Nuclear).
Permite que se depositen allí artículos de investigación, datos, software, informes y otro tipo de objeto digital relacionado con la investigación. La ventaja frente a github es que asigna un **DOI**.

Las versiones de paquetes se pueden registrar en zenodo.
No obstante, **no tan practico**  ya que cada versión tiene su propio doi y la versión anterior no puede ser eliminada.

---


class: inverse

# Recapitulando

- [Que es un paquete](#intro)  
- [Licencia](#licencia)  
- [Como agregar datos](#datos)
- [Agregar datos al paquete](#datos_ex) 
- [Como crear función](#funciones)
- [Crear función](#funciones_ex)
- [Como crear hexsticker](#sticker)

.right[
### Contacto

Para dudas, comentarios y sugerencias:&lt;br&gt;
 Escríbeme a miriamjlerma@gmail.com

Este material esta accesible 
y se encuentra en &lt;br&gt;
 mi [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4cc9f0;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt;github](https://github.com/MiriamLL/Curso_CIAD/)
]





    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
